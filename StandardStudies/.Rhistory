# Load necessary libraries from the renv library
library(CDMConnector)
library(CohortCharacteristics)
library(IncidencePrevalence)
library(PatientProfiles)
cdm <- mockIncidencePrevalence(sampleSize = 2000)
cdm <- generateDenominatorCohortSet(
cdm = cdm,
name = "denominator",
cohortDateRange = as.Date(c("2008-01-01", "2012-01-01"))
)
inc <- estimateIncidence(
cdm = cdm,
denominatorTable = "denominator",
outcomeTable = "outcome",
interval = "years",
outcomeWashout = Inf,
repeatedEvents = FALSE
)
characteristics <- summariseCharacteristics(
cohort = cdm$denominator
)
tableCharacteristics(characteristics)
unlink("rmd/patient_level_characterisation_cache", recursive = TRUE)
knit_with_parameters("~/repos/OMOPAnalyticsGuide/R/rmd/patient_level_characterisation.Rmd")
# Set up knitr options for knitting the Rmd file.
# The upload.fun option modifies the image path for embedding in the final document.
knitr::opts_knit$set(upload.fun = function(x) sub("^\\.\\./\\.\\./", "/", x))
# The fig.path option sets the directory where plots generated by the R code chunks will be saved.
knitr::opts_chunk$set(fig.path = "../../assets/images/rmd_output/")
library(CDMConnector)
library(CohortCharacteristics)
library(PatientProfiles)
library(visOmopResults)
library(DrugUtilisation)
# Create a mock CDM object for demonstration purposes.
# This simulates a real CDM and populates it with synthetic data.
cdm <- DrugUtilisation::mockDrugUtilisation(numberIndividuals = 10000)
# Generate a cohort of individuals based on the ingredient "acetaminophen".
# This cohort will be used for the characterization analysis.
cdm <- generateIngredientCohortSet(
cdm = cdm,
name = "cohort",
ingredient = "acetaminophen"
)
# Summarize the number of subjects and records in the cohort.
counts <- summariseCohortCount(cdm$cohort)
# Display the cohort counts in a table.
tableCohortCount(counts)
# Summarize the attrition of the cohort, showing how many subjects are dropped at each step of the cohort definition.
attr <- summariseCohortAttrition(cdm$cohort)
# Display the cohort attrition in a table.
tableCohortAttrition(attr)
# Summarize the baseline characteristics of the cohort.
# This creates a "Table 1" with demographics, conditions, drugs, etc.
chars <- summariseCharacteristics(cdm$cohort)
# Display the baseline characteristics in a table.
tableCharacteristics(chars)
# Create a plot of the age distribution by cohort.
# First, filter the characteristics data to select only the "Age" variable.
plot_data <- dplyr::filter(chars, variable_name == "Age")
# Generate a boxplot of the age distribution, colored by cohort name.
plotCharacteristics(plot_data, plotType = "boxplot", colour = "cohort_name")
# Define a list of concepts to create flags for.
# We'll use arbitrary concept IDs for this example,
# representing conditions like 'headache' and 'fever'.
cdm$cohort |>
addSex() |>
summariseCharacteristics(
demographics = FALSE,
strata = list("sex"),
conceptIntersectFlag = list(
"Concomitant disorders" = list(
conceptSet = list(headache = 378253, asthma = 317009, influenza = 4266367),
window = c(-Inf, Inf)
))
) |>
# Display the characteristics table, which now includes the new flags.
tableCharacteristics(
header = c("sex"),
hide = c("cdm_name", "cohort_name", "variable_level", "table_name")
)
