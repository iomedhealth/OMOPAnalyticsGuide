# Page: Plot Themes and Styling

# Plot Themes and Styling

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [R/plottingThemes.R](R/plottingThemes.R)
- [man/barPlot.Rd](man/barPlot.Rd)
- [man/boxPlot.Rd](man/boxPlot.Rd)
- [man/scatterPlot.Rd](man/scatterPlot.Rd)
- [man/themeVisOmop.Rd](man/themeVisOmop.Rd)

</details>



This document covers the visual theming and styling system for plots generated by visOmopResults. The package provides built-in themes for consistent plot appearance and supports custom styling through ggplot2 integration.

For information about plot function usage and parameters, see [Plot Functions and Usage](#3.1). For details about the overall plot generation architecture, see [Plot Generation System](#3).

## Theme System Overview

The visOmopResults package implements a theming system that provides consistent visual styling across all plot types. The system is built on top of ggplot2's theming capabilities and integrates seamlessly with the plot generation pipeline.

```mermaid
graph TD
    subgraph "Plot Functions"
        barPlot["barPlot()"]
        scatterPlot["scatterPlot()"] 
        boxPlot["boxPlot()"]
    end
    
    subgraph "Style Parameter Processing"
        styleParam["style parameter"]
        styleCheck["Style validation"]
    end
    
    subgraph "Theme Application"
        defaultTheme["themeVisOmop()"]
        darwinTheme["themeDarwin()"]
        nullTheme["NULL (ggplot2 default)"]
    end
    
    subgraph "ggplot2 Integration"
        ggplotBase["ggplot2 base plot"]
        themeLayer["+ theme layer"]
        finalPlot["Final styled plot"]
    end
    
    barPlot --> styleParam
    scatterPlot --> styleParam
    boxPlot --> styleParam
    
    styleParam --> styleCheck
    styleCheck -->|"style = 'default'"| defaultTheme
    styleCheck -->|"style = 'darwin'"| darwinTheme
    styleCheck -->|"style = NULL"| nullTheme
    
    defaultTheme --> themeLayer
    darwinTheme --> themeLayer
    nullTheme --> ggplotBase
    
    ggplotBase --> themeLayer
    themeLayer --> finalPlot
```

**Theme Integration Architecture**

Sources: [R/plottingThemes.R:35-125](), [man/barPlot.Rd:36-38](), [man/scatterPlot.Rd:47-49](), [man/boxPlot.Rd:43-45]()

## Built-in Themes

The package provides two predefined themes designed for different use cases and organizational requirements.

### themeVisOmop - Default Theme

The `themeVisOmop()` function provides the package's default styling with a clean, professional appearance suitable for scientific publications.

```mermaid
graph LR
    subgraph "themeVisOmop Styling Components"
        colors["Color Scheme"]
        typography["Typography"]
        layout["Layout Elements"]
        spacing["Spacing & Margins"]
    end
    
    subgraph "Color Definitions"
        background["background: #ffffff"]
        gridMajor["grid.major: #d9d9d9"]
        axisText["axis.text: #252525"]
        border["border: #595959"]
    end
    
    subgraph "Typography Settings"
        titleSize["plot.title: fontsizeRef+2, bold"]
        axisLabels["axis.text: fontsizeRef-1"]
        axisTitle["axis.title: fontsizeRef"]
        legendText["legend.text: fontsizeRef-1"]
    end
    
    subgraph "Layout Configuration"
        facetStrip["strip.background: #e5e6e4"]
        facetText["strip.text: bold, fontsizeRef-1"]
        legendPos["legend.position: right"]
        margins["plot.margin: 0.35,0.2,0.3,0.35 cm"]
    end
    
    colors --> background
    colors --> gridMajor
    colors --> axisText
    colors --> border
    
    typography --> titleSize
    typography --> axisLabels
    typography --> axisTitle
    typography --> legendText
    
    layout --> facetStrip
    layout --> facetText
    layout --> legendPos
    layout --> spacing
    
    spacing --> margins
```

**themeVisOmop Component Structure**

Key styling characteristics:
- **Neutral color palette**: White background with gray grid lines and borders
- **Consistent typography**: Scalable font sizes based on `fontsizeRef` parameter (default: 10)
- **Subtle facet styling**: Light gray facet strip backgrounds with bold text
- **Professional grid**: Light gray major grid lines for easy data reading

Sources: [R/plottingThemes.R:35-69](), [man/themeVisOmop.Rd:1-27]()

### themeDarwin - Darwin EU Theme

The `themeDarwin()` function implements the Darwin EU organizational branding with distinctive blue accents and white text on colored backgrounds.

| Component | themeVisOmop | themeDarwin | Purpose |
|-----------|--------------|-------------|---------|
| Facet strip background | `#e5e6e4` (light gray) | `#003399` (Darwin blue) | Brand identification |
| Facet text color | Default (dark) | `#FFFFFF` (white) | Contrast on blue background |
| Border color | `#595959` (dark gray) | `#d2d2d2` (light gray) | Softer appearance |
| Strip border | `color.border` | `#ffffff` (white) for x, `#003399` for y | Directional distinction |

The Darwin theme maintains the same typography scaling and layout structure as the default theme while applying organizational branding through strategic color choices.

Sources: [R/plottingThemes.R:89-125]()

## Applying Themes to Plots

Themes are applied through the `style` parameter available in all plot functions: `barPlot()`, `scatterPlot()`, and `boxPlot()`.

### Style Parameter Options

| Style Value | Theme Applied | Use Case |
|-------------|---------------|----------|
| `"default"` | `themeVisOmop()` | General scientific publications |
| `"darwin"` | `themeDarwin()` | Darwin EU branded materials |
| `NULL` | ggplot2 default | Custom styling or minimal appearance |

### Example Usage

```r
# Apply default visOmopResults styling
barPlot(result, x = "cohort_name", y = "mean", style = "default")

# Apply Darwin EU branding
barPlot(result, x = "cohort_name", y = "mean", style = "darwin") 

# Use base ggplot2 styling for custom themes
barPlot(result, x = "cohort_name", y = "mean", style = NULL) + custom_theme()
```

Sources: [man/barPlot.Rd:36-38](), [man/scatterPlot.Rd:47-49](), [man/boxPlot.Rd:43-45]()

## Custom Styling and Extensions

The package's theming system is designed to work seamlessly with ggplot2's theming capabilities, enabling extensive customization.

```mermaid
graph TD
    subgraph "Custom Styling Approaches"
        builtinModification["Modify Built-in Theme"]
        customTheme["Create Custom Theme"]
        layeredStyling["Layered Theme Application"]
    end
    
    subgraph "Built-in Theme Modification"
        useBuiltin["Use style = 'default' or 'darwin'"]
        addLayers["+ additional theme() layers"]
        overrideElements["Override specific elements"]
    end
    
    subgraph "Custom Theme Creation"
        nullStyle["Use style = NULL"]
        customFunction["Create custom theme function"]
        applyCustom["Apply with + operator"]
    end
    
    subgraph "ggplot2 Integration"
        ggplotObject["ggplot2 object returned"]
        themeFunction["theme() function calls"]
        elementFunctions["element_text(), element_rect(), etc."]
    end
    
    builtinModification --> useBuiltin
    useBuiltin --> addLayers
    addLayers --> overrideElements
    
    customTheme --> nullStyle
    nullStyle --> customFunction
    customFunction --> applyCustom
    
    layeredStyling --> ggplotObject
    ggplotObject --> themeFunction
    themeFunction --> elementFunctions
```

**Custom Styling Architecture**

### Font Size Customization

Both built-in themes accept a `fontsizeRef` parameter for consistent typography scaling:

```r
# Larger text for presentations
barPlot(result, x = "cohort", y = "mean", style = "default") + 
  themeVisOmop(fontsizeRef = 14)

# Smaller text for dense layouts  
barPlot(result, x = "cohort", y = "mean", style = "darwin") + 
  themeDarwin(fontsizeRef = 8)
```

### Theme Extension Examples

```r
# Modify built-in theme
plot <- barPlot(result, x = "cohort", y = "mean", style = "default")
plot + theme(
  legend.position = "bottom",
  axis.text.x = element_text(angle = 45, hjust = 1)
)

# Complete custom theme
plot <- barPlot(result, x = "cohort", y = "mean", style = NULL)  
plot + theme_minimal() + theme(
  strip.text = element_text(face = "bold"),
  panel.grid.minor = element_blank()
)
```

Sources: [R/plottingThemes.R:35-69](), [R/plottingThemes.R:89-125]()

## Technical Implementation Details

The theming system is implemented through ggplot2's layered grammar of graphics, with themes applied as additional layers to the base plot object.

### Theme Function Structure

Both `themeVisOmop()` and `themeDarwin()` follow a consistent implementation pattern:

1. **Parameter validation**: `omopgenerics::assertNumeric(fontsizeRef)`
2. **Color definition**: Local variables for consistent color usage
3. **Base theme**: Start with `ggplot2::theme_bw()`
4. **Element customization**: Override specific theme elements
5. **Return**: ggplot2 theme object for layer addition

### Color System

```mermaid
graph TD
    subgraph "Color Variables (both themes)"
        colorBg["color.background = '#ffffff'"]
        colorGrid["color.grid.major = '#d9d9d9'"]
        colorAxis["color.axis.text = '#252525'"]
        colorTitle["color.axis.title = '#252525'"]
    end
    
    subgraph "Theme-specific Colors"
        visomoopBorder["themeVisOmop: color.border = '#595959'"]
        darwinBorder["themeDarwin: color.border = '#d2d2d2'"]
        darwinStrip["themeDarwin: strip.background = '#003399'"]
        darwinText["themeDarwin: strip.text.colour = '#FFFFFF'"]
    end
    
    colorBg --> visomoopBorder
    colorBg --> darwinBorder
    colorGrid --> darwinStrip
    colorAxis --> darwinText
```

**Color System Architecture**

The consistent color variable naming pattern enables easy maintenance and potential extension to additional themes.

Sources: [R/plottingThemes.R:37-42](), [R/plottingThemes.R:91-95]()