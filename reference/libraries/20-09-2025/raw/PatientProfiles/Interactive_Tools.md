# Page: Interactive Tools

# Interactive Tools

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [extras/shinysummary.R](extras/shinysummary.R)

</details>



## Purpose and Scope

This document covers the interactive tools available for exploring and visualizing patient characteristics data generated by the PatientProfiles package. The primary interactive tool is a Shiny application that provides a web-based dashboard for filtering, viewing, and downloading summary characteristics results.

For information about generating the underlying summary data that powers these interactive tools, see [Data Summarization](#3.2).

## Shiny Application Overview

The PatientProfiles package includes a comprehensive Shiny application located in [extras/shinysummary.R:1-209]() that provides an interactive dashboard for exploring patient characteristics. The application is built using the `shinydashboard` framework and integrates multiple visualization and data manipulation packages including `gt`, `DT`, and `shinyWidgets`.

### Application Architecture

```mermaid
graph TB
    subgraph "Data Layer"
        MOCK["mockDrugUtilisation()"]
        COHORT["cdm$cohort1 |> addSex()"]
        SUMMARY["summariseCharacteristics()"]
        PROCESSED["Processed summaryCharacteristics"]
    end
    
    subgraph "UI Components"
        HEADER["dashboardHeader('Study title')"]
        SIDEBAR["dashboardSidebar"]
        MENU["sidebarMenu('Summary characteristics')"]
        BODY["dashboardBody"]
        FILTERS["Filter Controls"]
        TABS["tabsetPanel"]
    end
    
    subgraph "Filter Controls"
        CDM_FILTER["pickerInput('summary_characteristics_cdm_name')"]
        GROUP_FILTER["pickerInput('summary_characteristics_group')"]
        STRATA_FILTER["pickerInput('summary_characteristics_strata')"]
        VARIABLE_FILTER["pickerInput('summary_characteristics_variable')"]
        ESTIMATE_FILTER["pickerInput('summary_characteristics_estimate_type')"]
    end
    
    subgraph "Output Views"
        RAW_TABLE["DTOutput('summary_characteristics_table_raw')"]
        TIDY_TABLE["gt_output('summary_characteristics_table_tidy')"]
        DOWNLOADS["downloadHandler Functions"]
    end
    
    subgraph "Server Logic"
        REACTIVE["get_summary_characteristics_data()"]
        RAW_RENDER["renderDataTable()"]
        TIDY_RENDER["render_gt()"]
        DOWNLOAD_HANDLERS["Download Handlers"]
    end
    
    MOCK --> COHORT
    COHORT --> SUMMARY
    SUMMARY --> PROCESSED
    
    HEADER --> BODY
    SIDEBAR --> MENU
    MENU --> BODY
    BODY --> FILTERS
    BODY --> TABS
    
    FILTERS --> CDM_FILTER
    FILTERS --> GROUP_FILTER
    FILTERS --> STRATA_FILTER
    FILTERS --> VARIABLE_FILTER
    FILTERS --> ESTIMATE_FILTER
    
    TABS --> RAW_TABLE
    TABS --> TIDY_TABLE
    TABS --> DOWNLOADS
    
    PROCESSED --> REACTIVE
    CDM_FILTER --> REACTIVE
    GROUP_FILTER --> REACTIVE
    STRATA_FILTER --> REACTIVE
    VARIABLE_FILTER --> REACTIVE
    ESTIMATE_FILTER --> REACTIVE
    
    REACTIVE --> RAW_RENDER
    REACTIVE --> TIDY_RENDER
    REACTIVE --> DOWNLOAD_HANDLERS
    
    RAW_RENDER --> RAW_TABLE
    TIDY_RENDER --> TIDY_TABLE
    DOWNLOAD_HANDLERS --> DOWNLOADS
```

**Sources:** [extras/shinysummary.R:35-195]()

### Data Processing Pipeline

The application demonstrates a complete workflow for generating and displaying patient characteristics:

```mermaid
flowchart LR
    subgraph "Data Generation"
        LOAD["devtools::load_all()"]
        MOCK_CDM["mockDrugUtilisation(numberIndividuals = 100)"]
        ADD_DEMO["addSex()"]
        SUMMARISE["summariseCharacteristics()"]
    end
    
    subgraph "Data Transformation"
        MUTATE_GROUP["mutate(group = paste0(group_name, group_level))"]
        MUTATE_STRATA["mutate(strata = paste0(strata_name, strata_level))"]
        SELECT_COLS["select(-c('group_name', 'group_level', ...))"]
        RELOCATE["relocate('cdm_name', 'group', 'strata')"]
    end
    
    subgraph "Interactive Features"
        FILTER_REACTIVE["Reactive Filtering"]
        RAW_VIEW["Raw Data View"]
        TIDY_VIEW["Tidy Table View"]
        DOWNLOAD_CSV["CSV Downloads"]
        DOWNLOAD_WORD["Word Downloads"]
    end
    
    LOAD --> MOCK_CDM
    MOCK_CDM --> ADD_DEMO
    ADD_DEMO --> SUMMARISE
    
    SUMMARISE --> MUTATE_GROUP
    MUTATE_GROUP --> MUTATE_STRATA
    MUTATE_STRATA --> SELECT_COLS
    SELECT_COLS --> RELOCATE
    
    RELOCATE --> FILTER_REACTIVE
    FILTER_REACTIVE --> RAW_VIEW
    FILTER_REACTIVE --> TIDY_VIEW
    FILTER_REACTIVE --> DOWNLOAD_CSV
    FILTER_REACTIVE --> DOWNLOAD_WORD
```

**Sources:** [extras/shinysummary.R:10-33](), [extras/shinysummary.R:138-191]()

## Key Features

### Interactive Filtering System

The application provides comprehensive filtering capabilities through five main filter controls:

| Filter Control | Input ID | Purpose |
|----------------|----------|---------|
| CDM Name | `summary_characteristics_cdm_name` | Filter by database source |
| Group | `summary_characteristics_group` | Filter by patient groups |
| Strata | `summary_characteristics_strata` | Filter by stratification variables |
| Variables | `summary_characteristics_variable` | Select specific characteristics |
| Estimate Type | `summary_characteristics_estimate_type` | Choose statistical measures |

Each filter uses `pickerInput()` widgets with multi-select capabilities and action boxes for bulk selection operations.

**Sources:** [extras/shinysummary.R:56-109]()

### Data Visualization Options

The application provides two distinct views of the data:

1. **Raw Data View**: Uses `DTOutput()` with `renderDataTable()` to display filterable, sortable tabular data with horizontal scrolling capabilities
2. **Tidy Table View**: Uses `gt_output()` with `render_gt()` to create publication-ready formatted tables using the `pivotSettings()` function

**Sources:** [extras/shinysummary.R:112-128](), [extras/shinysummary.R:147-163]()

### Download Functionality

The application includes three download handlers:

| Download Type | Output File | Content |
|---------------|-------------|---------|
| Raw Complete | `summaryCharacteristicsTable.csv` | Full unfiltered dataset |
| Raw Filtered | `summaryCharacteristicsTableFiltered.csv` | Current filtered view |
| Tidy Word | `summaryCharacteristicsTable.docx` | Formatted table document |

**Sources:** [extras/shinysummary.R:164-191]()

### Server-Side Reactivity

The core reactive function `get_summary_characteristics_data()` implements the filtering logic by chaining `filter()` operations for each filter input:

```r
get_summary_characteristics_data <- reactive({
  summaryCharacteristics |>
    filter(variable %in% input$summary_characteristics_variable) |>
    filter(cdm_name %in% input$summary_characteristics_cdm_name) |>
    filter(estimate_type %in% input$summary_characteristics_estimate_type) |>
    filter(group %in% input$summary_characteristics_group) |>
    filter(strata %in% input$summary_characteristics_strata)
})
```

**Sources:** [extras/shinysummary.R:138-145]()

## Example Data Configuration

The application demonstrates a realistic patient characteristics analysis setup:

- **Population**: 100 individuals from mock drug utilization study
- **Demographics**: Sex stratification using `addSex()`
- **Age Groups**: Categorized into 5 age bands (0-19, 20-39, 40-59, 60-79, 80-150)
- **Clinical Intersections**: 
  - Visit counts from `visit_occurrence` table over previous 365 days
  - Medication flags from cohort intersections
- **Statistical Parameters**: Minimum cell count threshold of 1

**Sources:** [extras/shinysummary.R:12-33]()

## Deployment and Usage

The application is launched using the standard Shiny pattern with `shinyApp(ui, server)` at [extras/shinysummary.R:195](). The file also includes commented CSS customization options for styling the dashboard header and sidebar with custom colors.

**Sources:** [extras/shinysummary.R:195](), [extras/shinysummary.R:197-209]()