# Page: Overview

# Overview

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [DESCRIPTION](DESCRIPTION)
- [README.Rmd](README.Rmd)
- [README.md](README.md)

</details>



## Purpose and Scope

PhenotypeR is a comprehensive diagnostic system for assessing the research-readiness of study cohorts defined within OMOP Common Data Model (CDM) databases. The system performs multi-level analysis across database, codelist, cohort, and population dimensions to validate phenotype definitions and ensure cohorts meet quality standards for observational health research.

This document provides a high-level overview of the PhenotypeR system architecture and core capabilities. For detailed information about specific diagnostic modules, see [Core Diagnostic System](#2). For interactive visualization features, see [Interactive Visualization System](#3). For AI-powered expectation generation, see [AI-Powered Expectations](#2.5).

## System Architecture

PhenotypeR follows a modular architecture with four primary subsystems working together to provide comprehensive cohort assessment capabilities.

### Core System Components

```mermaid
graph TB
    subgraph "OMOP_CDM_Database"
        CDM_Tables["CDM Tables<br/>person, observation_period<br/>condition_occurrence, drug_exposure<br/>measurement, procedure_occurrence"]
        Achilles_Results["Achilles Results<br/>Pre-computed statistics"]
    end
    
    subgraph "Core_Diagnostic_Engine"
        phenotypeDiagnostics["phenotypeDiagnostics()<br/>Main orchestrator function"]
        databaseDiagnostics["databaseDiagnostics()<br/>Database-level analysis"]
        codelistDiagnostics["codelistDiagnostics()<br/>Concept usage analysis"]
        cohortDiagnostics["cohortDiagnostics()<br/>Cohort validation"]
        populationDiagnostics["populationDiagnostics()<br/>Incidence/prevalence"]
    end
    
    subgraph "AI_Expectations_System"
        getCohortExpectations["getCohortExpectations()<br/>LLM-powered analysis"]
        tableCohortExpectations["tableCohortExpectations()<br/>Expectation formatting"]
        ellmer_integration["ellmer package<br/>LLM interface"]
    end
    
    subgraph "Interactive_Visualization"
        shinyDiagnostics["shinyDiagnostics()<br/>App launcher"]
        shiny_ui["ui.R<br/>User interface"]
        shiny_server["server.R<br/>Business logic"]
        preprocess["preprocess.R<br/>Data preparation"]
    end
    
    subgraph "Output_Formats"
        summarised_result["summarised_result<br/>Standardized results"]
        interactive_app["Interactive Shiny App"]
        static_reports["Static Reports"]
    end
    
    CDM_Tables --> phenotypeDiagnostics
    Achilles_Results --> phenotypeDiagnostics
    
    phenotypeDiagnostics --> databaseDiagnostics
    phenotypeDiagnostics --> codelistDiagnostics
    phenotypeDiagnostics --> cohortDiagnostics
    phenotypeDiagnostics --> populationDiagnostics
    
    ellmer_integration --> getCohortExpectations
    getCohortExpectations --> tableCohortExpectations
    
    databaseDiagnostics --> summarised_result
    codelistDiagnostics --> summarised_result
    cohortDiagnostics --> summarised_result
    populationDiagnostics --> summarised_result
    
    summarised_result --> shinyDiagnostics
    tableCohortExpectations --> shinyDiagnostics
    
    shinyDiagnostics --> shiny_ui
    shinyDiagnostics --> shiny_server
    preprocess --> shiny_ui
    
    shiny_server --> interactive_app
    summarised_result --> static_reports
```

Sources: [DESCRIPTION:1-84](), [README.Rmd:30-54](), [README.md:15-39]()

## Data Flow and Processing Pipeline

The following diagram illustrates how data flows through the PhenotypeR system from OMOP CDM input to final diagnostic outputs.

### End-to-End Data Processing

```mermaid
flowchart TD
    subgraph "Input_Data"
        cohort_table["Cohort Table<br/>Generated by CohortConstructor"]
        cdm_reference["CDM Reference<br/>omopgenerics::cdm_reference"]
        concept_sets["Concept Sets<br/>CodelistGenerator codelists"]
    end
    
    subgraph "phenotypeDiagnostics_Function"
        input_validation["Input Validation<br/>omopgenerics::validateCohortTable()"]
        diagnostic_orchestration["Diagnostic Orchestration<br/>Parallel execution of modules"]
        result_binding["Result Binding<br/>omopgenerics::bind()"]
    end
    
    subgraph "Diagnostic_Modules"
        db_snapshot["Database Snapshot<br/>OmopSketch::summariseOmopSnapshot()"]
        codelist_analysis["Codelist Analysis<br/>CodelistGenerator diagnostics"]
        cohort_chars["Cohort Characteristics<br/>CohortCharacteristics functions"]
        incidence_prevalence["Incidence/Prevalence<br/>IncidencePrevalence package"]
        survival_analysis["Survival Analysis<br/>CohortSurvival package"]
        measurement_diag["Measurement Diagnostics<br/>MeasurementDiagnostics package"]
    end
    
    subgraph "AI_Expectation_Generation"
        llm_chat["LLM Chat Interface<br/>ellmer::chat()"]
        expectation_prompts["Expectation Prompts<br/>Structured queries"]
        expectation_parsing["Response Parsing<br/>tibble formatting"]
    end
    
    subgraph "Visualization_Pipeline"
        data_preprocessing["Data Preprocessing<br/>Filtering and transformation"]
        shiny_app_generation["Shiny App Generation<br/>Dynamic UI/Server creation"]
        interactive_deployment["Interactive Deployment<br/>Local or shinyapps.io"]
    end
    
    cohort_table --> input_validation
    cdm_reference --> input_validation
    concept_sets --> input_validation
    
    input_validation --> diagnostic_orchestration
    
    diagnostic_orchestration --> db_snapshot
    diagnostic_orchestration --> codelist_analysis
    diagnostic_orchestration --> cohort_chars
    diagnostic_orchestration --> incidence_prevalence
    diagnostic_orchestration --> survival_analysis
    diagnostic_orchestration --> measurement_diag
    
    db_snapshot --> result_binding
    codelist_analysis --> result_binding
    cohort_chars --> result_binding
    incidence_prevalence --> result_binding
    survival_analysis --> result_binding
    measurement_diag --> result_binding
    
    result_binding --> summarised_result_output["summarised_result Object<br/>Standardized format"]
    
    llm_chat --> expectation_prompts
    expectation_prompts --> expectation_parsing
    expectation_parsing --> expectation_table["Expectation Table<br/>tibble with expected values"]
    
    summarised_result_output --> data_preprocessing
    expectation_table --> data_preprocessing
    
    data_preprocessing --> shiny_app_generation
    shiny_app_generation --> interactive_deployment
```

Sources: [README.Rmd:121-123](), [README.Rmd:136-149](), [README.Rmd:152-154]()

## Core Diagnostic Capabilities

PhenotypeR provides four complementary diagnostic approaches to comprehensively assess cohort quality and research-readiness:

| Diagnostic Type | Purpose | Key Functions | Output |
|-----------------|---------|---------------|---------|
| **Database Diagnostics** | Understand database structure and coverage | `databaseDiagnostics()`, `OmopSketch` functions | Database size, time periods, observation patterns |
| **Codelist Diagnostics** | Validate concept usage and coverage | `codelistDiagnostics()`, `CodelistGenerator` functions | Concept usage, orphan codes, measurement patterns |
| **Cohort Diagnostics** | Assess cohort composition and quality | `cohortDiagnostics()`, `CohortCharacteristics` functions | Demographics, attrition, overlap, survival |
| **Population Diagnostics** | Measure population-level frequencies | `populationDiagnostics()`, `IncidencePrevalence` functions | Incidence rates, prevalence estimates |

Sources: [README.Rmd:33-54](), [DESCRIPTION:18-21]()

### Key Analysis Features

- **Multi-level Assessment**: Database, codelist, cohort, and population-level diagnostics
- **OMOP CDM Integration**: Native integration with OMOP standardized vocabularies and data structures
- **AI-Powered Expectations**: LLM-generated expected values for comparison with actual results
- **Interactive Visualization**: Web-based Shiny application for exploration and reporting
- **Scalable Processing**: Sampling strategies and preprocessing for large healthcare datasets
- **Research-Ready Output**: Standardized `summarised_result` format compatible with OHDSI tools

Sources: [README.Rmd:30-39](), [DESCRIPTION:67-81]()

## Integration with OMOP Ecosystem

PhenotypeR leverages the extensive OHDSI/OMOP ecosystem through deep integration with specialized packages:

```mermaid
graph LR
    subgraph "OHDSI_Core_Packages"
        omopgenerics["omopgenerics<br/>Base CDM operations"]
        CDMConnector["CDMConnector<br/>Database connectivity"]
        CohortConstructor["CohortConstructor<br/>Cohort generation"]
    end
    
    subgraph "Specialized_Analysis_Packages"
        CohortCharacteristics["CohortCharacteristics<br/>Demographics & characteristics"]
        CodelistGenerator["CodelistGenerator<br/>Concept set management"]
        IncidencePrevalence["IncidencePrevalence<br/>Epidemiological measures"]
        CohortSurvival["CohortSurvival<br/>Survival analysis"]
        OmopSketch["OmopSketch<br/>Database summaries"]
        MeasurementDiagnostics["MeasurementDiagnostics<br/>Measurement validation"]
    end
    
    subgraph "Visualization_Packages"
        visOmopResults["visOmopResults<br/>Result visualization"]
        shiny_ecosystem["Shiny Ecosystem<br/>reactable, plotly, DT"]
    end
    
    subgraph "AI_Integration"
        ellmer["ellmer<br/>LLM interface"]
    end
    
    subgraph "PhenotypeR_Core"
        phenotypeDiagnostics_main["phenotypeDiagnostics()<br/>Main orchestrator"]
        shinyDiagnostics_main["shinyDiagnostics()<br/>Visualization launcher"]
    end
    
    omopgenerics --> phenotypeDiagnostics_main
    CDMConnector --> phenotypeDiagnostics_main
    CohortConstructor --> phenotypeDiagnostics_main
    
    CohortCharacteristics --> phenotypeDiagnostics_main
    CodelistGenerator --> phenotypeDiagnostics_main
    IncidencePrevalence --> phenotypeDiagnostics_main
    CohortSurvival --> phenotypeDiagnostics_main
    OmopSketch --> phenotypeDiagnostics_main
    MeasurementDiagnostics --> phenotypeDiagnostics_main
    
    visOmopResults --> shinyDiagnostics_main
    shiny_ecosystem --> shinyDiagnostics_main
    
    ellmer --> phenotypeDiagnostics_main
    
    phenotypeDiagnostics_main --> shinyDiagnostics_main
```

Sources: [DESCRIPTION:67-81](), [DESCRIPTION:27-64]()

## Getting Started

To begin using PhenotypeR, users typically follow this workflow:

1. **Establish OMOP CDM Connection**: Connect to an OMOP CDM database using `CDMConnector`
2. **Define Study Cohorts**: Create cohorts using `CohortConstructor` functions
3. **Run Comprehensive Diagnostics**: Execute `phenotypeDiagnostics()` for complete assessment
4. **Generate AI Expectations**: Use `getCohortExpectations()` for LLM-powered comparisons
5. **Launch Interactive Application**: Use `shinyDiagnostics()` for web-based exploration

For detailed implementation guidance, see [Tutorials and Examples](#6). For development and testing information, see [Development and Testing](#4).

Sources: [README.Rmd:77-158](), [README.md:62-162]()